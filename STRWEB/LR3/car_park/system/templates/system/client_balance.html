{% extends 'base.html' %}
{% load static %}

{% block title %} Баланс клиентов {% endblock %}
{% block css %}
    <link rel="stylesheet" href="{% static 'css/system/client_balance.css' %}">
{% endblock %}

{% block content %}
	<h1>Баланс клиентов</h1>
	<form action="{% url 'client-balance' %}" method="post" class="balance-form">
		{% csrf_token %}
		<label for="start_date">Начальная дата:</label>
		<input type="date" id="start_date" name="start_date" value="{{ start_date|date:'Y-m-d' }}" required><br><br>
		<label for="end_date">Конечная дата:</label>
		<input type="date" id="end_date" name="end_date" value="{{ end_date|date:'Y-m-d' }}" required><br><br>
		<button type="submit">Рассчитать</button>
	</form>

	{% if client_balance %}
	<h2>Результат расчета баланса</h2>
	<table border="1" class="client-balance-table">
		<tr>
			<th colspan="5">Информация о клиенте</td>
		</tr>
		<tr>
			<th id="id">ID</th>
			<th id="name">Имя</th>
			<th id="email">Почта</th>
			<th id="balance">Баланс</th>
			<th id="history">История оплат</th>
		</tr>
		{% for client in client_balance %}
			<tr>
				<td headers="id">{{ client.client.id }}</td>
				<td headers="name">{{ client.client.user.get_full_name }}</td>
				<td headers="email">{{ client.client.user.email }}</td>
				<td headers="balance">{{ client.total }}</td>
				<td headers="history"><a class="history-link" href="{% url 'client-payments' client.client.id %}?start_date={{ start_date|date:'Y-m-d' }}&end_date={{ end_date|date:'Y-m-d' }}">Перейти</a></td>
			</tr>
		{% endfor %}
	</table>
	{% endif %}

{% endblock %}